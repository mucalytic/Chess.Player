var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Player=function(){function n(){}return n.create=function(n){switch(n.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},n}(),Red=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Red",e.turn=1,e}return __extends(e,n),e.prototype.transform=function(n,e){return[n,e]},e}(Player),Blue=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Blue",e.turn=2,e}return __extends(e,n),e.prototype.transform=function(n,e){return[-e,n]},e}(Player),Yellow=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Yellow",e.turn=3,e}return __extends(e,n),e.prototype.transform=function(n,e){return[-n,-e]},e}(Player),Green=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Green",e.turn=4,e}return __extends(e,n),e.prototype.transform=function(n,e){return[e,-n]},e}(Player),Dead=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.name="Dead",e.turn=0,e}return __extends(e,n),e.prototype.transform=function(n,e){throw new Error("Not implemented")},e}(Player),Vector=function(){return function(n,e){this.dx=n,this.dy=e}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.counter<this.max?(this.counter++,{value:this.counter,done:!1}):(this.counter=0,{value:void 0,done:!0})},n.prototype.reset=function(){this.counter=0},n}(),Piece=function(){function n(n){this.player=Player.create(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return}},n}(),Rook=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Rook",t.radius=new Radius,t}return __extends(e,n),e.prototype.attack=function(){return[]},e.prototype.mobility=function(){return[[new Vector(function(n,e){return n+e},function(n){return n}),!0],[new Vector(function(n,e){return n-e},function(n){return n}),!0],[new Vector(function(n){return n},function(n,e){return n+e}),!0],[new Vector(function(n){return n},function(n,e){return n-e}),!0]]},e}(Piece),Pawn=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Pawn",t.radius=new Radius(2),t}return __extends(e,n),e.prototype.attack=function(){return[[new Vector(function(n){return n+1},function(n){return n+1}),!0],[new Vector(function(n){return n-1},function(n){return n+1}),!0]]},e.prototype.mobility=function(){return[[new Vector(function(n){return n},function(n,e){return n+e}),!0]]},e}(Piece),King=function(n){function e(e){var t=n.call(this,e)||this;return t.name="King",t.radius=new Radius(1),t}return __extends(e,n),e.prototype.attack=function(){return[]},e.prototype.mobility=function(){return[[new Vector(function(n){return n+1},function(n){return n}),!0],[new Vector(function(n){return n-1},function(n){return n}),!0],[new Vector(function(n){return n},function(n){return n+1}),!0],[new Vector(function(n){return n},function(n){return n-1}),!0],[new Vector(function(n){return n+1},function(n){return n+1}),!0],[new Vector(function(n){return n+1},function(n){return n-1}),!0],[new Vector(function(n){return n-1},function(n){return n+1}),!0],[new Vector(function(n){return n-1},function(n){return n-1}),!0]]},e}(Piece),Queen=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Queen",t.radius=new Radius,t}return __extends(e,n),e.prototype.attack=function(){return[]},e.prototype.mobility=function(){return[[new Vector(function(n,e){return n+e},function(n){return n}),!0],[new Vector(function(n,e){return n-e},function(n){return n}),!0],[new Vector(function(n){return n},function(n,e){return n+e}),!0],[new Vector(function(n){return n},function(n,e){return n-e}),!0],[new Vector(function(n,e){return n+e},function(n,e){return n+e}),!0],[new Vector(function(n,e){return n+e},function(n,e){return n-e}),!0],[new Vector(function(n,e){return n-e},function(n,e){return n+e}),!0],[new Vector(function(n,e){return n-e},function(n,e){return n-e}),!0]]},e}(Piece),Bishop=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Bishop",t.radius=new Radius,t}return __extends(e,n),e.prototype.attack=function(){return[]},e.prototype.mobility=function(){return[[new Vector(function(n,e){return n+e},function(n,e){return n+e}),!0],[new Vector(function(n,e){return n+e},function(n,e){return n-e}),!0],[new Vector(function(n,e){return n-e},function(n,e){return n+e}),!0],[new Vector(function(n,e){return n-e},function(n,e){return n-e}),!0]]},e}(Piece),Knight=function(n){function e(e){var t=n.call(this,e)||this;return t.name="Knight",t.radius=new Radius(1),t}return __extends(e,n),e.prototype.attack=function(){return[]},e.prototype.mobility=function(){return[[new Vector(function(n){return n+2},function(n){return n+1}),!0],[new Vector(function(n){return n+2},function(n){return n-1}),!0],[new Vector(function(n){return n-2},function(n){return n+1}),!0],[new Vector(function(n){return n-2},function(n){return n-1}),!0],[new Vector(function(n){return n+1},function(n){return n+2}),!0],[new Vector(function(n){return n+1},function(n){return n-2}),!0],[new Vector(function(n){return n-1},function(n){return n+2}),!0],[new Vector(function(n){return n-1},function(n){return n-2}),!0]]},e}(Piece),Square=function(){function n(n,e){return this.m=n,this.n=e,this}return n.coords=function(n){return[parseInt(n.slice(1))-1,n.charCodeAt(0)-97]},n.prototype.char=function(n){return String.fromCharCode(n+97)},n.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},n.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},n}(),DiffSquare=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e}(Square),AnalysisSquare=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.candidates=[],e}return __extends(e,n),e}(Square),Board=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var e=0;e<14;e++)this.squares[n][e]=new Square(n,e)}}return n.prototype.square=function(n){var e=Square.coords(n);return this.squares[e[0]][e[1]]},n.prototype.valid=function(n,e){return n>=0&&n<=13&&e>=0&&e<=13},n}(),Diff=function(){function n(){this.deaths=[],this.captures=[],this.removals=[],this.additions=[],this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var e=0;e<14;e++)this.squares[n][e]=new DiffSquare(n,e)}}return n.prototype.square=function(n){var e=DiffSquare.coords(n);return this.squares[e[0]][e[1]]},n}(),Analysis=function(){function n(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var e=0;e<14;e++)this.squares[n][e]=new AnalysisSquare(n,e)}}return n.prototype.square=function(n){var e=AnalysisSquare.coords(n);return this.squares[e[0]][e[1]]},n}(),Turn=function(){return function(n){this.diff=new Diff,this.added=new Board,this.removed=new Board,this.analysis=new Analysis,this.index=n}}(),Factory=function(){function n(){this.turns=[]}return n.prototype.piece=function(n){for(var e=0;e<n.length;e++){var t=n[e];if(t instanceof HTMLElement&&0===t.className.indexOf("piece-"))return t}},n.prototype.createBoards=function(n,e){var t=e.removedNodes,r=e.addedNodes;if(r.length>=14&&t.length>=14)for(var o=0;o<14;o++)for(var u=0;u<14;u++){var i=r[o].childNodes[u],c=t[o].childNodes[u];if(i instanceof HTMLElement&&c instanceof HTMLElement){var a=this.piece(i.childNodes),s=this.piece(c.childNodes);if(a){var f=a.attributes["data-piece"],l=i.attributes["data-square"];if(f&&l){var d=Piece.create(f.value);n.added.square(l.value).piece=d}}if(s){f=s.attributes["data-piece"],l=c.attributes["data-square"];if(f&&l){d=Piece.create(f.value);n.removed.square(l.value).piece=d}}}}},n.prototype.createDiffBoard=function(n){for(var e=0;e<14;e++)for(var t=0;t<14;t++){var r=n.removed.squares[e][t],o=n.added.squares[e][t],u=n.diff.squares[e][t];!r.piece&&o.piece&&(n.diff.additions.push(o),u.piece=o.piece,u.change="+"),r.piece&&!o.piece&&(n.diff.removals.push(r),u.piece=r.piece,u.change="-"),r.piece&&o.piece&&r.piece.dp!==o.piece.dp&&(u.piece=o.piece,o.piece.player instanceof Dead?(n.diff.deaths.push(o),u.change="x"):(n.diff.captures.push(o),u.change="*"))}},n.prototype.process=function(n){for(var e=0,t=0,r=n;t<r.length;t++){var o=r[t];if("childList"===o.type&&o.target instanceof HTMLElement&&0===o.target.className.indexOf("board-")){var u=new Turn(++e);this.createBoards(u,o),this.createDiffBoard(u),this.turns.push(u)}}return this},n.prototype.analyse=function(){for(var n=1;n<this.turns.length;n++){console.log("turn:"+n);var e=new Analysis,t=this.turns[n],r=t.added;console.log("analysing");for(var o=0;o<14;o++)for(var u=0;u<14;u++){var i=r.squares[o][u];console.log("square:m["+i.m+"], n["+i.n+"]");var c=i.accessible();if(console.log("accessible:"+c),c){var a=i.piece;if(a){var s=a.player;if(console.log("piece:"+s.name+" "+a.name),!(s instanceof Dead)){var f=s.transform(u,o),l=f[0],d=f[1];console.log("x:"+l+", y:"+d);var p=a.mobility();for(console.log("begin radius loop");;){var h=a.radius.next();console.log("result.done:"+h.done);for(var v=0,y=0;y<p.length;y++)p[y][1]&&v++;if(console.log("remaining:"+v),h.done||h.value>14||0===v){console.log("breaking out of radius loop"),a.radius.reset();break}var w=h.value;console.log("begin move loop");for(y=0;y<p.length;y++)if(p[y][1]){var m=p[y][0].dy(d,w),g=p[y][0].dx(l,w);if(console.log("radius:"+w+", dx:"+g+", dy:"+m),r.valid(g,m)){var q=r.squares[m][g];if(console.log("target:m["+q.m+"], n["+q.n+"]"),q.accessible()){var _=q.code(),V=e.square(_);console.log("code:"+_+", goal:m["+V.m+"], n["+V.n+"]"),V.candidates.push(a);for(var x=[],b=0;b<V.candidates.length;b++)x.push(V.candidates[b].player.name+" "+V.candidates[b].name);var P=x.join(", ");console.log("candidates:"+P),q.piece&&(p[y][1]=!1,console.log("target square has a piece"))}else p[y][1]=!1,console.log("target square is not accessible")}else p[y][1]=!1,console.log("target square is out of bounds")}console.log("end move loop")}console.log("end radius loop")}}}}t.analysis=e}return this},n.prototype.header=function(n){return"Index: "+n.index+"; Additions: "+n.diff.additions.length+"; Removals: "+n.diff.removals.length+"; Captures: "+n.diff.captures.length+"; Deaths: "+n.diff.deaths.length},n.prototype.show=function(n){for(var e=1;e<Math.min(this.turns.length,n);e++){var t=this.turns[e];console.group(this.header(t)),console.log("                                                                                                          0   1   2   3   4   5   6   7   8   9  10  11  12  13");for(var r=0;r<14;r++){for(var o=["|"],u=0;u<14;u++){var i=t.added.squares[r][u];o.push(i.piece?i.piece.dp:"[]")}o.push("|");for(u=0;u<14;u++){i=t.diff.squares[r][u];o.push(i.piece?i.piece.dp+i.change:"[ ]")}o.push("|");var c=t.analysis.squares;console.log(o.join(" ")+"%i %O %O %O %O %O %O %O %O %O %O %O %O %O %O |",r,c[r][0],c[r][1],c[r][2],c[r][3],c[r][4],c[r][5],c[r][6],c[r][7],c[r][8],c[r][9],c[r][10],c[r][11],c[r][12],c[r][13])}console.groupEnd()}return this},n}();