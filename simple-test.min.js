var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Player=function(){return function(n){switch(n.charAt(0)){case"w":this.name="Red";break;case"g":this.name="Blue";break;case"d":this.name="Dead";break;case"r":this.name="Green";break;case"b":this.name="Yellow";break;default:this.name=void 0}}}(),Vector=function(){return function(n,t){this.dx=n,this.dy=t}}(),Radius=function(){function n(n){this.counter=0,this.max=n}return n.prototype.next=function(){return!this.max||this.max&&this.max>=++this.counter?{value:this.counter,done:!1}:{value:null,done:!0}},n}(),Piece=function(){function n(n){this.player=new Player(n),this.dp=n}return n.create=function(n){switch(n.charAt(1)){case"R":return new Rook(n);case"P":return new Pawn(n);case"K":return new King(n);case"Q":return new Queen(n);case"B":return new Bishop(n);case"N":return new Knight(n);default:return null}},n}(),Rook=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Rook",e.jump=!1,e.radius=new Radius,e.mobility=[new Vector(function(n,t){return n+t},function(n){return n}),new Vector(function(n,t){return n-t},function(n){return n}),new Vector(function(n){return n},function(n,t){return n+t}),new Vector(function(n){return n},function(n,t){return n-t})],e}return __extends(t,n),t}(Piece),Pawn=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Pawn",e.jump=!1,e.radius=new Radius(2),e.mobility=[new Vector(function(n){return n},function(n,t){return n+t})],e}return __extends(t,n),t}(Piece),King=function(n){function t(t){var e=n.call(this,t)||this;return e.name="King",e.jump=!1,e.radius=new Radius(1),e.mobility=[new Vector(function(n){return n+1},function(n){return n}),new Vector(function(n){return n-1},function(n){return n}),new Vector(function(n){return n},function(n){return n+1}),new Vector(function(n){return n},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+1}),new Vector(function(n){return n+1},function(n){return n-1}),new Vector(function(n){return n-1},function(n){return n+1}),new Vector(function(n){return n-1},function(n){return n-1})],e}return __extends(t,n),t}(Piece),Queen=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Queen",e.jump=!1,e.radius=new Radius,e.mobility=[new Vector(function(n,t){return n+t},function(n){return n}),new Vector(function(n,t){return n-t},function(n){return n}),new Vector(function(n){return n},function(n,t){return n+t}),new Vector(function(n){return n},function(n,t){return n-t}),new Vector(function(n,t){return n+t},function(n,t){return n+t}),new Vector(function(n,t){return n+t},function(n,t){return n-t}),new Vector(function(n,t){return n-t},function(n,t){return n+t}),new Vector(function(n,t){return n-t},function(n,t){return n-t})],e}return __extends(t,n),t}(Piece),Bishop=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Bishop",e.jump=!1,e.radius=new Radius,e.mobility=[new Vector(function(n,t){return n+t},function(n,t){return n+t}),new Vector(function(n,t){return n+t},function(n,t){return n-t}),new Vector(function(n,t){return n-t},function(n,t){return n+t}),new Vector(function(n,t){return n-t},function(n,t){return n-t})],e}return __extends(t,n),t}(Piece),Knight=function(n){function t(t){var e=n.call(this,t)||this;return e.name="Knight",e.jump=!0,e.radius=new Radius(1),e.mobility=[new Vector(function(n){return n+2},function(n){return n+1}),new Vector(function(n){return n+2},function(n){return n-1}),new Vector(function(n){return n-2},function(n){return n+1}),new Vector(function(n){return n-2},function(n){return n-1}),new Vector(function(n){return n+1},function(n){return n+2}),new Vector(function(n){return n+1},function(n){return n-2}),new Vector(function(n){return n-1},function(n){return n+2}),new Vector(function(n){return n-1},function(n){return n-2})],e}return __extends(t,n),t}(Piece),Square=function(){function n(n,t){this.code=this.convert(n,t),this.m=n,this.n=t}return n.prototype.convert=function(n,t){return""+String.fromCharCode(t+97)+(n+1)},n}(),Board=function(){return function(){this.squares=[];for(var n=0;n<14;n++){this.squares[n]=[];for(var t=0;t<14;t++)this.squares[n][t]=new Square(n,t)}}}(),Turn=function(){return function(n){this.datetime=n,this.board=new Board}}(),Variance=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.additions=[],t.captures=[],t.removals=[],t.deaths=[],t}return __extends(t,n),t.prototype.addition=function(n){for(var t=0,e=this.additions;t<e.length;t++){var r=e[t];if(r.piece.dp===n.piece.dp)return r}return null},t.prototype.removal=function(n){for(var t=0,e=this.removals;t<e.length;t++){var r=e[t];if(r.piece.dp===n.piece.dp)return r}return null},t}(Turn),Factory=function(){function n(){this.turns=[],this.variances=[]}return n.prototype.turn=function(n){for(var t=0,e=this.turns;t<e.length;t++){var r=e[t];if(r.datetime===n)return r}return null},n.prototype.variance=function(n){for(var t=0,e=this.variances;t<e.length;t++){var r=e[t];if(r.datetime===n)return r}return null},n.prototype.process=function(n){for(var t=0,e=n;t<e.length;t++){var r=e[t];if("childList"===r.mutation.type&&r.mutation.target.attributes["data-square"]){var u=this.turn(r.datetime);u||(u=new Turn(r.datetime),this.turns.push(u));var i=r.mutation.target.attributes["data-square"].value;if(1===r.mutation.addedNodes.length)for(var o=r.mutation.addedNodes[0].attributes["data-piece"].value,c=0;c<14;c++)for(var a=0;a<14;a++)u.board.squares[c][a].code===i&&(u.board.squares[c][a].piece=Piece.create(o))}}return this},n.prototype.analyse=function(){if(this.turns.length>1)for(var n=1;n<this.turns.length;n++){for(var t=new Variance(this.turns[n].datetime),e=0;e<14;e++)for(var r=0;r<14;r++){var u=this.turns[n].board.squares[e][r],i=this.turns[n-1].board.squares[e][r];!i.piece&&u.piece&&(t.additions.push(u),t.board.squares[e][r].change="+",t.board.squares[e][r].piece=u.piece),i.piece&&!u.piece&&(t.removals.push(i),t.board.squares[e][r].change="-",t.board.squares[e][r].piece=i.piece),i.piece&&u.piece&&i.piece.dp!==u.piece.dp&&(t.board.squares[e][r].piece=u.piece,"Dead"===u.piece.player.name?(t.deaths.push(u),t.board.squares[e][r].change="x"):(t.captures.push(u),t.board.squares[e][r].change="*"))}for(var o=0,c=t.removals;o<c.length;o++){var a=c[o];(h=t.addition(a))||(t.board.squares[a.m][a.n].piece=void 0)}for(var s=0,f=t.additions;s<f.length;s++){var h=f[s];if(!(a=t.removal(h)))for(e=0;e<14;e++)for(r=0;r<14;r++){var d=this.turns[n-1].board.squares[e][r].piece;if(d&&d.dp===h.piece.dp)for(;d.radius.next();)for(var p=0,l=d.mobility;p<l.length;p++)l[p]}}this.variances.push(t)}return this},n.prototype.apply=function(){return this},n.prototype.header=function(n,t){return"When: "+n.datetime+"                         Additions: "+t.additions.length+"     Removals: "+t.removals.length+"     Captures: "+t.captures.length+"     Deaths: "+t.deaths.length},n.prototype.show=function(n){for(var t=1;t<Math.min(this.turns.length,n);t++){var e=this.turns[t],r=this.variance(e.datetime);console.log(this.header(e,r));for(var u=0;u<14;u++){for(var i="[ ",o=0;o<14;o++){(c=e.board.squares[u][o]).piece?i+=c.piece.dp:i+="[]",i+=" "}i+="]  |  [ ";for(o=0;o<14;o++){var c;(c=r.board.squares[u][o]).piece?(i+=c.piece.dp,i+=c.change):i+="[ ]",i+=" "}i+="]",console.log(i)}console.log("")}return this},n}();