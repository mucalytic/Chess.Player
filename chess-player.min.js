var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Player=function(){function t(){}return t.create=function(t){switch(t.charAt(0)){case"w":return new Red;case"g":return new Blue;case"b":return new Yellow;case"r":return new Green;case"d":return new Dead;default:return}},t}(),Red=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Red",n.turn=1,n}return __extends(n,t),n.prototype.transform=function(t,n,e,r){return[t+e,n+r]},n}(Player),Blue=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Blue",n.turn=2,n}return __extends(n,t),n.prototype.transform=function(t,n,e,r){return[t+r,n-e]},n}(Player),Yellow=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Yellow",n.turn=3,n}return __extends(n,t),n.prototype.transform=function(t,n,e,r){return[t-e,n-r]},n}(Player),Green=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Green",n.turn=4,n}return __extends(n,t),n.prototype.transform=function(t,n,e,r){return[t-r,n+e]},n}(Player),Dead=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Dead",n.turn=0,n}return __extends(n,t),n.prototype.transform=function(t,n){throw new Error("Not implemented")},n}(Player),Vector=function(){return function(t,n){this.x1=t,this.y1=n}}(),Radius=function(){function t(t){this.counter=0,this.max=t}return t.prototype.next=function(){return!this.max||this.counter<this.max?(this.counter++,{value:this.counter,done:!1}):(this.counter=0,{value:void 0,done:!0})},t.prototype.reset=function(){this.counter=0},t}(),Piece=function(){function t(t,n){this.coords=Square.coords(n),this.player=Player.create(t),this.dp=t}return t.prototype.moved=function(){for(var t=!0,n=0;n<this.home.length;n++){var e=this.home[n][0]-6.5,r=this.home[n][1]-6.5,o=this.player.transform(6.5,6.5,r,e),i=o[0],u=o[1];if(this.coords[1]===i&&this.coords[0]===u){t=!1;break}}return t},t.create=function(t,n){switch(t.charAt(1)){case"R":return new Rook(t,n);case"P":return new Pawn(t,n);case"K":return new King(t,n);case"Q":return new Queen(t,n);case"B":return new Bishop(t,n);case"N":return new Knight(t,n);default:return}},t}(),Rook=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Rook",n.radius=new Radius,n.home=[[0,3],[0,10]],n}return __extends(n,t),n.prototype.attack=function(){return[]},n.prototype.mobility=function(){return[[new Vector(function(t){return t},function(t){return 0}),!0],[new Vector(function(t){return-t},function(t){return 0}),!0],[new Vector(function(t){return 0},function(t){return t}),!0],[new Vector(function(t){return 0},function(t){return-t}),!0]]},n}(Piece),Pawn=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Pawn",n.radius=new Radius(1),n.home=[[1,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[1,10]],n}return __extends(n,t),n.prototype.attack=function(){return[[new Vector(function(t){return 1},function(t){return 1}),!0],[new Vector(function(t){return-1},function(t){return 1}),!0]]},n.prototype.mobility=function(){return this.moved()?[[new Vector(function(t){return 0},function(t){return 1}),!0]]:[[new Vector(function(t){return 0},function(t){return 1}),!0],[new Vector(function(t){return 0},function(t){return 2}),!0]]},n}(Piece),King=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="King",n.radius=new Radius(1),n.home=n.player instanceof Red||n.player instanceof Yellow?[[0,7]]:[[0,6]],n}return __extends(n,t),n.prototype.attack=function(){return[]},n.prototype.mobility=function(){return[[new Vector(function(t){return 1},function(t){return 0}),!0],[new Vector(function(t){return-1},function(t){return 0}),!0],[new Vector(function(t){return 0},function(t){return 1}),!0],[new Vector(function(t){return 0},function(t){return-1}),!0],[new Vector(function(t){return 1},function(t){return 1}),!0],[new Vector(function(t){return 1},function(t){return-1}),!0],[new Vector(function(t){return-1},function(t){return 1}),!0],[new Vector(function(t){return-1},function(t){return-1}),!0]]},n}(Piece),Queen=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Queen",n.radius=new Radius,n.home=n.player instanceof Red||n.player instanceof Yellow?[[0,6]]:[[0,7]],n}return __extends(n,t),n.prototype.attack=function(){return[]},n.prototype.mobility=function(){return[[new Vector(function(t){return t},function(t){return 0}),!0],[new Vector(function(t){return-t},function(t){return 0}),!0],[new Vector(function(t){return 0},function(t){return t}),!0],[new Vector(function(t){return 0},function(t){return-t}),!0],[new Vector(function(t){return t},function(t){return t}),!0],[new Vector(function(t){return t},function(t){return-t}),!0],[new Vector(function(t){return-t},function(t){return t}),!0],[new Vector(function(t){return-t},function(t){return-t}),!0]]},n}(Piece),Bishop=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Bishop",n.radius=new Radius,n.home=[[0,5],[0,8]],n}return __extends(n,t),n.prototype.attack=function(){return[]},n.prototype.mobility=function(){return[[new Vector(function(t){return t},function(t){return t}),!0],[new Vector(function(t){return t},function(t){return-t}),!0],[new Vector(function(t){return-t},function(t){return t}),!0],[new Vector(function(t){return-t},function(t){return-t}),!0]]},n}(Piece),Knight=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="Knight",n.radius=new Radius(1),n.home=[[0,4],[0,9]],n}return __extends(n,t),n.prototype.attack=function(){return[]},n.prototype.mobility=function(){return[[new Vector(function(t){return 2},function(t){return 1}),!0],[new Vector(function(t){return 2},function(t){return-1}),!0],[new Vector(function(t){return-2},function(t){return 1}),!0],[new Vector(function(t){return-2},function(t){return-1}),!0],[new Vector(function(t){return 1},function(t){return 2}),!0],[new Vector(function(t){return 1},function(t){return-2}),!0],[new Vector(function(t){return-1},function(t){return 2}),!0],[new Vector(function(t){return-1},function(t){return-2}),!0]]},n}(Piece),Square=function(){function t(t,n){return this.candidates=[],this.m=t,this.n=n,this}return t.coords=function(t){return[parseInt(t.slice(1))-1,t.charCodeAt(0)-97]},t.prototype.char=function(t){return String.fromCharCode(t+97)},t.prototype.code=function(){return""+this.char(this.n)+(this.m+1)},t.prototype.accessible=function(){return this.m>=3&&this.m<=10&&this.n>=0&&this.n<=2||this.m>=0&&this.m<=13&&this.n>=3&&this.n<=10||this.m>=3&&this.m<=10&&this.n>=11&&this.n<=13},t}(),Board=function(){function t(){this.squares=[];for(var t=0;t<14;t++){this.squares[t]=[];for(var n=0;n<14;n++)this.squares[t][n]=new Square(t,n)}}return t.prototype.square=function(t){var n=Square.coords(t);return this.squares[n[0]][n[1]]},t.prototype.valid=function(t,n){return t>=0&&t<=13&&n>=0&&n<=13},t}(),CountdownHelper=function(){function t(){this.counter=60,this.enabled=!1,this.utterances=[60]}return t.prototype.username=function(){return document.getElementById("four-player-username").innerText},t.prototype.avatar=function(t){for(var n=0;n<t.length;n++){var e=t[n];if(e instanceof HTMLElement&&e.classList.contains("player-avatar"))return e}},t.prototype.current=function(t){return parseFloat(t.oldValue.trim().split(":")[1])},t.prototype.reset=function(t){if("childList"===t.type&&t.target instanceof HTMLDivElement&&0===t.target.classList.length&&1===t.addedNodes.length){var n=t.addedNodes[0];if(n instanceof HTMLElement&&n.classList.contains("modal-container"))n.querySelector(".game-over-container")&&(this.utterances=[60],this.counter=60)}},t.prototype.words=function(){return this.counter<=5?this.counter.toString():this.counter+" seconds left"},t.prototype.utterance=function(){return this.rate(new SpeechSynthesisUtterance(this.words()))},t.prototype.rate=function(t){return t.rate=1.8,t},t.prototype.utter=function(t){if(this.enabled&&"characterData"===t.type){var n=t.target.parentNode.parentNode;if(n&&n instanceof HTMLElement&&n.classList.contains("player-clock-timer")){var e=this.avatar(n.childNodes);if(e&&e instanceof HTMLAnchorElement&&e.pathname==="/member/"+this.username()){var r=this.current(t);this.counter-r>0&&this.counter-r<=1&&(this.counter=r),(this.counter<=5&&this.counter%1==0||this.counter>5&&this.counter%5==0)&&this.counter!==this.utterances[0]&&(window.speechSynthesis.speak(this.utterance()),this.utterances.unshift(this.counter))}}}},t}(),AnalysisHelper=function(){function t(){this.colours=["red","blue","yellow","green"]}return t.prototype.process=function(t){"childList"===t.type&&t.target instanceof HTMLElement&&0===t.target.className.indexOf("board-")&&(this.board=new Board,this.name=this.me(),this.create(t),this.analyse(),this.threats(t))},t.prototype.create=function(t){var n=t.addedNodes;if(n.length>=14)for(var e=0;e<14;e++)for(var r=0;r<14;r++){var o=n[e].childNodes[r];if(o instanceof HTMLElement){var i=this.piece(o.childNodes);if(i){var u=o.attributes["data-square"],a=i.attributes["data-piece"];if(u&&a){var c=Piece.create(a.value,u.value);this.board.square(u.value).piece=c}}}}},t.prototype.analyse=function(){for(var t=0;t<14;t++)for(var n=0;n<14;n++){var e=this.board.squares[t][n];if(e.accessible()){var r=e.piece;r&&(r.player instanceof Dead||(this.radius(r,r.mobility(),!0,t,n),this.radius(r,r.attack(),!1,t,n)))}}},t.prototype.threats=function(t){var n=t.addedNodes;if(n.length>=14)for(var e=0;e<14;e++)for(var r=0;r<14;r++){var o=n[e].childNodes[r];if(o instanceof HTMLElement){var i=this.piece(o.childNodes);if(i){var u=o.attributes["data-square"];if(u){for(var a=[],c=[],s=this.board.square(u.value),f=0;f<s.candidates.length;f++){s.candidates[f].player.name.toLowerCase()===this.name?a.push(s.candidates[f]):c.push(s.candidates[f])}if(i instanceof HTMLElement){var l=a.length>=c.length;i.style.backgroundColor=this.colour(i,l)}}}}}},t.prototype.show=function(){for(var t=0;t<14;t++){for(var n=["|"],e=0;e<14;e++){var r=this.board.squares[t][e];r.accessible()?n.push(r.piece?r.piece.dp:"[]"):n.push("  ")}n.push("|");var o=this.board.squares;console.log(n.join(" ")+"%O %O %O %O %O %O %O %O %O %O %O %O %O %O |",o[t][0],o[t][1],o[t][2],o[t][3],o[t][4],o[t][5],o[t][6],o[t][7],o[t][8],o[t][9],o[t][10],o[t][11],o[t][12],o[t][13])}},t.prototype.me=function(){for(var t=document.getElementById("four-player-username").innerText,n=document.body.getElementsByClassName("player-avatar"),e=0;e<n.length;e++){var r=n[e];if(r instanceof HTMLAnchorElement&&-1!==r.href.indexOf(t))for(var o=r.parentElement,i=0;i<o.classList.length;i++)for(var u=0;u<this.colours.length;u++)if(this.colours[u]===o.classList[i])return this.colours[u]}},t.prototype.colour=function(t,n){var e,r=window.getComputedStyle(t,null).getPropertyValue("background-color");if(0===r.indexOf("#")&&(e=this.hexToRgb(r)),0===r.indexOf("rgb")){r.substring(4,r.length-1).split(", ");e={r:parseInt(r[0]),g:parseInt(r[1]),b:parseInt(r[2])}}return n?"rgb("+e.r+", 255, "+e.b+")":"rgb(255, "+e.g+", "+e.b+")"},t.prototype.hexToRgb=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,n,e,r){return n+n+e+e+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},t.prototype.remaining=function(t){for(var n=0,e=0;e<t.length;e++)t[e][1]&&n++;return n},t.prototype.radius=function(t,n,e,r,o){for(;;){var i=t.radius.next(),u=this.remaining(n);if(i.done||i.value>14||0===u){t.radius.reset();break}for(var a=0;a<n.length;a++)this.vector(t,n[a],e,r,o,i.value)}},t.prototype.vector=function(t,n,e,r,o,i){if(n[1]){var u=n[0].x1(i),a=n[0].y1(i),c=t.player.transform(o,r,u,a),s=c[0],f=c[1];this.board.valid(s,f)&&this.board.squares[f][s].accessible()?this.board.squares[f][s].piece?(e&&this.board.squares[f][s].candidates.push(t),n[1]=!1):this.board.squares[f][s].candidates.push(t):n[1]=!1}},t.prototype.piece=function(t){for(var n=0;n<t.length;n++){var e=t[n];if(e instanceof HTMLElement&&0===e.className.indexOf("piece-"))return e}},t}(),DomWatcher=function(){function t(){this.analysis=new AnalysisHelper,this.countdown=new CountdownHelper,this.init={characterDataOldValue:!0,attributeOldValue:!0,characterData:!0,attributes:!0,childList:!0,subtree:!0},this.createDocumentBodyObserverSubscription(),this.observer.observe(document.body,this.init)}return t.prototype.createDocumentBodyObserverSubscription=function(){var t=this;this.observer=new MutationObserver(function(n){n.forEach(function(n){t.countdown.reset(n),t.countdown.utter(n),t.analysis.process(n)})})},t}(),DomModifier=function(){function t(){this.domWatcher=new DomWatcher,this.rightAlignStartButton(),this.addStartAiButton()}return t.prototype.addStartAiButton=function(){var t=this,n=document.getElementsByClassName("btns-container")[0];if(n instanceof HTMLElement){n.style.cssFloat="right";var e=n.cloneNode(!0);if(e instanceof HTMLElement){e.style.cssFloat="left",e.style.marginRight="12px";var r=e.firstChild;"A"===r.nodeName&&r instanceof HTMLElement&&(r.innerText="Start AI",r.classList.remove("new-game-btn"));var o=e.cloneNode(!0);if(o instanceof HTMLElement){o.style.display="none";var i=o.firstChild;"A"===i.nodeName&&i instanceof HTMLElement&&(i.innerText="Stop AI",i.style.color="#b4b4b3",i.style.borderBottom="#272422",i.style.backgroundColor="#272422",i.addEventListener("click",function(){t.domWatcher.countdown.enabled=!1,o.style.display="none",e.style.display="block"})),r.addEventListener("click",function(){t.domWatcher.countdown.enabled=!0,o.style.display="block",e.style.display="none"})}n.parentNode.appendChild(e),n.parentNode.appendChild(o)}}return this},t.prototype.rightAlignStartButton=function(){var t=document.getElementsByTagName("head")[0];if(t instanceof HTMLElement){var n=document.createTextNode(".btns-container { float: right; }"),e=document.createElement("style");e instanceof HTMLElement&&(e.type="text/css",e.appendChild(n)),t.appendChild(e)}return this},t}(),modifier=new DomModifier;